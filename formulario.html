<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Locação</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   <div class="lado-direito-formulario">
     <img id="imgLivro" src="" alt="Capa do Livro" width="200px">

     <div class="descrição">
        <h3 id="tituloLivro" style="color: white; margin-top: 10px;"></h3>
     </div>
     
     <ul id="listaDetalhes" style="color: white; list-style-position: inside;">
        </ul>
   </div>
   
   <div class="lado-esquerdo-formulario">
    <h2>Preencha os seus dados abaixo para fazer a locação do livro</h2>
    <br>

    <div class="formulario-locação">
               <label for="nome">Nome Completo</label>
               <input type="text" id="nome" placeholder="Digite seu nome" required>

               <label for="numero">Número de Telefone</label>
               <input type="number" id="numero" placeholder="(xx) 9xxxx-xxxx" required>

               <label for="RA">Código RA</label>
               <input type="text" id="RA" placeholder="Ex: 123456" required>

               <label for="Curso">Curso que está fazendo no momento</label>
               <input type="text" id="Curso" placeholder="Ex: Técnico em Informática" required>

               <label for="Turno">Turno</label>
               <input type="text" id="Turno" placeholder="Diurno ou Noturno?" required>

               <button type="button" onclick="abrirModalConfirmacao()">Confirmar Locação</button>



   </div>
   </div>

        <div id="modalSucesso" class="modal">
        <div class="modal-conteudo">
            <span class="fechar" onclick="fecharModal()">&times;</span>
            <h2 style="color: green; margin-bottom: 15px;">Locação Realizada!</h2>
            
            <p id="mensagemFinal" style="font-size: 16px; line-height: 1.5; color: #333; text-align: justify;">
                </p>

            <button onclick="fecharModal()" style="background-color: green; margin-top: 20px;">Entendi</button>
        </div>
   </div>


   <script>
       //FUNÇÃO PARA PEGAR O ID DA URL
       function pegarIdDaUrl() {
           const params = new URLSearchParams(window.location.search);
           return params.get('id') // Pega o que está depois de ?id=
       }

       // Recupera ID da URL ou do LocalStorage (Fallback)
       var idLivro = pegarIdDaUrl() || localStorage.getItem("livro_id_escolhido")

       // Recupera dados do aluno (se houver login feito)
       var alunoNome = localStorage.getItem("aluno_nome")
       var alunoRA = localStorage.getItem("aluno_ra")

       if(alunoNome) document.getElementById("nome").value = alunoNome
       if(alunoRA) document.getElementById("RA").value = alunoRA

      
       const dadosDosLivros = {
           'automacao': {
               titulo: 'Automação Industrial',
               imagem: 'Automação industrial.jpg',
               paginas: '367 páginas',
               autor: 'Frank Lamb',
               data: '8 junho 2015',
               edicao: '1ª Edição',
               idioma: 'Português',
               sinopse: 'Este livro aborda controladores lógicos programáveis e sistemas pneumáticos.'
               
           },
           'poder-habito': {
               titulo: 'O Poder do Hábito',
               imagem: 'Poder do habito.jpg',
               paginas: '408 páginas',
               autor: 'Charles Duhigg',
               data: '24 setembro 2012',
               edicao: '1ª Edição',
               idioma: 'Português',
               sinopse:'explica como hábitos se formam, funcionam e moldam vidas e negócios, baseando-se em neurociência e exemplos práticos. O autor introduz o loop do hábito deixa-rotina-recompensa e demonstra que identificar e alterar esses padrões é a chave para o sucesso e transformação pessoal/empresarial.'
           },
           'eletronica': {
               titulo: 'Eletrônica Básica',
               imagem: 'Eletronica basica.jpg',
               paginas: '540 páginas',
               autor: 'Newton C. Braga',
               data: '2020',
               edicao: '2ª Edição',
               idioma: 'Português',
               sinopse: 'Estuda o controle do fluxo de elétrons através de componentes como resistores, diodos e transistores para processar, armazenar ou transmitir informações.'
           },

           '48leisdopoder':{
            titulo: '48 Leis do Poder',
            imagem: '48 leis do poder.jpg',
            paginas: '544 páginas',
            autor: 'Robert Greene',
            data: ' 2001',
            edicao: '1ª Edição',
            idioma: 'Português',
            sinopse: 'é um best-seller que compila três mil anos de história para traçar um guia estratégico sobre como conquistar, defender-se e entender o poder nas relações sociais e profissionais. Com tom amoral e polêmico, o livro ensina manipulação, dissimulação e inteligência política. ',
           },


           'cidadededeus':{
            titulo: 'Cidade de Deus',
            imagem: 'Cidade de deus.jpg',
            paginas: '550 páginas',
            autor: 'Paulo Lins',
            data: '1997',
            edicao: '1ª Edição',
            idioma: 'Português',
            sinopse: 'É um romance que narra a evolução da violenta favela carioca de mesmo nome, desde os anos 60 até os 90, mostrando a transição da pequena criminalidade para o domínio do tráfico de drogas, através da história de personagens como Buscapé, um jovem fotógrafo que tenta escapar desse ciclo, e Zé Pequeno, um traficante cruel; a obra, baseada em pesquisa antropológica, retrata a vida na favela com realismo, denunciando a exclusão social e a violência sistêmica, e se tornou um clássico da literatura brasileira contemporânea, famosa também pela adaptação para o cinema. ',
           }
       }


       

       // CARREGA AS INFORMAÇÕES NA TELA
       function carregarLivro() {
           // Verifica se o ID existe no nosso banco de dados
           if (idLivro && dadosDosLivros[idLivro]) {
               var dados = dadosDosLivros[idLivro];

               document.getElementById("imgLivro").src = dados.imagem
               // Agora pegamos o título de dentro do objeto dados
               document.getElementById("tituloLivro").innerText = dados.titulo

               var listaHTML = `
                   <li>Páginas: ${dados.paginas}</li>
                   <li>Editora: ${dados.editora}</li>
                   <li>Publicação: ${dados.data}</li>
                   <li>Edição: ${dados.edicao}</li>
                   <li>Idioma: ${dados.idioma}</li>
                   <li>Sinopse: ${dados.sinopse}</li>
               `
               document.getElementById("listaDetalhes").innerHTML = listaHTML
           } else {
               // Se acessou a página sem ID nenhum
               document.getElementById("tituloLivro").innerText = "Selecione um livro ou leia o QR Code"
           }
       }

       carregarLivro()

       //MODAL
       function abrirModalConfirmacao() {
           // Coletar os dados atuais do formulário
           var nomeAluno = document.getElementById("nome").value;
           var raAluno = document.getElementById("RA").value;
           var telefoneAluno = document.getElementById("numero").value;
           var cursoAluno = document.getElementById("Curso").value;
           
           // Pega o nome do livro (tenta pelo ID, se não der pega o texto da tela)
           var nomeLivro = dadosDosLivros[idLivro] ? dadosDosLivros[idLivro].titulo : document.getElementById("tituloLivro").innerText;
           
           // Pega a data de hoje
           var dataHoje = new Date().toLocaleDateString("pt-BR");

           // Criar o objeto do empréstimo
           var novoEmprestimo = {
               aluno: nomeAluno,
               ra: raAluno,
               telefone: telefoneAluno,
               curso: cursoAluno,
               livro: nomeLivro,
               data: dataHoje,
               status: "Emprestado"
           };

           // RECUPERAR a lista antiga que já está na memória (ou criar uma vazia)
           // Usamos JSON.parse para transformar o texto da memória em uma lista do Javascript
           var listaAntiga = JSON.parse(localStorage.getItem("bd_emprestimos") || "[]");

           // ADICIONAR o novo empréstimo na lista
           listaAntiga.push(novoEmprestimo);

           // SALVAR a lista atualizada de volta na memória
           localStorage.setItem("bd_emprestimos", JSON.stringify(listaAntiga));

      

           // Agora mostra o modal visualmente como já fazia antes
           var texto = "Locação confirmada para o livro <b>" + nomeLivro + "</b>.<br>Registro salvo no sistema.";
           document.getElementById("mensagemFinal").innerHTML = texto;
           document.getElementById("modalSucesso").style.display = "flex";
           window.location.href="index.html"
       }

       function fecharModal() {
           function fecharModal() {
    
           document.getElementById("modalSucesso").style.display = "none"
           document.getElementById("nome").value = "";
           document.getElementById("numero").value = "";
          
       }
       }

       window.onclick = function(event) {
           if (event.target == document.getElementById("modalSucesso")) {
               fecharModal()
           }
       }
   </script>
</body>
</html>
